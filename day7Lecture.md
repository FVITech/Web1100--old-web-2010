##Day 7:
The first half of the class is discussion about servers, and an implementation of a simple hello world server on node. The second half is a talk about sessions and scaling. We open the lecture with a discussion of web app server architecture by showing these videos:

https://www.youtube.com/watch?v=e4S8zfLdLgQ  
Put into context: Every link, script, img tag generates a separate request. The original request generated by your typing a url or clicking a link spawns a chain reaction after it gets the html and fires off a ton more requests. That's why many modern devs have workflows which concatenate and minify all their scripts and stylesheets before deploying.

https://www.youtube.com/watch?v=FTAPjr7vgxE  
Make sure to explain that the definition of servers is very fuzzy. A server is no longer really just a machine. It can be and usually is a program.

We then demonstrate the functioning of apache by having students log into their digital ocean space, edit their pages right as they sit on the web server and view changes in the browser.

Now we show how web application servers work. We fire up a node server and create three basic routes using express. The first route is just a hello world route and the others demonstrate request parameters and query strings. The query string is just the POST body.

--- break ---

We start off with explaining the concepts of authentication and authorization, and how they are necessary within the context of any web app such as twitter. Login form -> post request -> server -> db -> server -> bifurcated path depending on whether credentials were valid -> response -> browser

Authorization: middleware that checks whether the user is authorized to receive the payload of the request he or she just made.

Then we explain http sessions as detailed in here: http://machinesaredigging.com/2013/10/29/how-does-a-web-session-work/
Key points:  

1. HTTP is stateless. Respond to request and that's it, no information about anything that happened before.

2. I could send the username with every request but if I did that then anyone who knows your username can see your profile and so on  

3. So I could also ask for username and password with every request but that would be a pretty horrible solution too because then nobody would use the internet  

4. So that's where sessions come in.  

  * After you log in one time, the server creates a new session id with some info about your session (at least your username) and saves it somewhere  

  * Show and explain :  

  ![alt text](http://machinesaredigging.com/blog-mad/wp-content/uploads/2013/10/session_cycle.jpg "HTTP Sessions")

  * So your user needs to be sending the session id every time they send a request in order for the server to know they are authenticated. Three ways to send session id:

    * Query string

    * Cookie

    * Request header

  * Session management is a feature of the server, you usually need to activate it.

  * Logging in is not the only use of the session. In the olden days you could use the session to store data about like a form that posted or something like that, so that you could use this data to render content.

  * That's why sometimes if you were browsing the web and sent a link to someone they'd get an error.

  * Another way to implement sessions: transferring all session data in an encrypted way back and forth every time, storing it in a cookie or in localstorage in the user's browser.

Then we talk about the scalability drawbacks (as it pertains to sessions). We start by recapping what scalability/scaling is. Then we talk about load balancing, new VMs, then we move on to the pitfalls:
  * Loss of data during transmission means now you have 2 sessions  
  * With some implementations of sessions (ie memory usage) when the app restarts then all user sessions are lost, which can start a spiral of issues when they all hit the db to log in at the same time.  
  * Furthermore, there can be memory leak problems if you don't close and destroy your sessions manually.  
  * Usually sessions are closed when you close your browser.  
  * In every back end framework you are going to have slightly different options when implementing sessions.  

Recap: sessions can be stored in server memory, database, and also in encrypted cookie/localstorage data that the user has to send with every request.  


Another solution to the authorization problem: token based authentication, which is a stateless way to carry the session.  
Further reading on sessions, including how to create memory stores and db stores:   http://expressjs-book.com/index.html%3Fp=128.html


Practical, easy to follow examples on implementing sessions:  
http://blog.modulus.io/nodejs-and-express-sessions


Other links we could discuss, depending on how the class receives the above: Database scaling:  
http://www.rightscale.com/blog/enterprise-cloud-strategies/architecting-scalable-applications-cloud-database-tier  

Stateless authentication:  
https://scotch.io/tutorials/the-ins-and-outs-of-token-based-authentication

Rest of the day we go through a guided practice exercise which will provide an introduction to nodeJS, npm, and a quick survey of tooling. We build a hello world server using express and see how easy sessions are to implement using express-session middleware. We follow Randy's express sessions primer.
